<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: tween.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: tween.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * 通过给定初始状态、结束状态和过度时间来实现一个补间动画。
 *
 * @example
 * // 创建一个补间动画
 * moto.tween({
 *   from: 0,
 *   to: 1,
 *   duration: .5
 * }).start(v => {
 *   console.log(v)
 * })
 * @exports tween
 * @memberof moto
 * @func tween
 * @param {object} option - tween 函数参数
 * @param {object|number} option.from - 初始状态：{x: 0, y: 0} 或者 0
 * @param {object|number} option.to - 结束状态：{x: 10, y: 10} 或者 10
 * @param {number} [option.duration=1] - 动画时长：单位s
 * @param {function} [option.ease=t=>t] - 时间函数：t => t 或者 t => t ** 2
 * @param {number} [option.yoyo=0] - 回荡次数：默认 0
 * @param {number} [option.loop=0] - 循环次数：默认 0
 * @return {Tween}
 */



export default function(option) {
  const
    {
      from, to,
      duration = 1,
      ease = t => t,
      yoyo = 0,
      loop = 0
    } = option

  /**
   * @typedef start
   * @type {function}
   * @param {object|function} option
   * @return {object}
   */
  function start(option) {
    const
      complex = isNaN(from),
      count = {
        yoyo: 0,
        loop: 0
      }

    let
      update, complete,
      id, delta, result,
      t = 0, forward = 1,
      stoped = false, paused = false,
      finished = false

    complex ? (delta = {}, result = {}, Object.keys(from).forEach(key => {
      delta[key] = to[key] - from[key]
    })) : delta = to - from

    option instanceof Function ? update = option : {update, complete} = option

    run()
    function run() {
      t += (1 / 60 / duration) * forward
      t > 1 ? t = 1 : t &lt; 0 ? t = 0 : null

      if (complex) for (const key in delta) {
        result[key] = from[key] + delta[key] * ease(t)
      } else result = from + delta * ease(t)

      update(result)

      if ((forward === 1 &amp;&amp; t === 1) ||
        (forward === -1 &amp;&amp; t === 0)) {
        if (loop > count.loop) {
          count.loop++
          t = 0
          id = requestAnimationFrame(run)
        } else if (yoyo > count.yoyo) {
          count.yoyo++
          forward *= -1
          id = requestAnimationFrame(run)
        } else {
          finished = true
          complete &amp;&amp; complete()
        }
      } else {
        id = requestAnimationFrame(run)
      }
    }
    /**
     * @typedef {object} Action
     * @property {function} stop - 停止动画
     * @property {function} pause - 暂停动画
     * @property {function} resume - 恢复动画
     */
    return {
      stop() {
        stoped = true
        cancelAnimationFrame(id)
      },

      pause() {
        if (stoped || finished) return this
        paused = true
        cancelAnimationFrame(id)
        return this
      },

      resume() {
        paused &amp;&amp; (paused = false, run())
        return this
      }
    }
  }
  /**
   * @typedef {object} Tween
   * @method {start} start - 开始执行动画
   */
  return {start}
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="moto.html">moto</a></li></ul><h3>Global</h3><ul><li><a href="global.html#%257Bstart%257Dstart-%25E5%25BC%2580%25E5%25A7%258B%25E6%2589%25A7%25E8%25A1%258C%25E5%258A%25A8%25E7%2594%25BB">{start} start - 开始执行动画</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Wed Dec 26 2018 21:10:58 GMT+0800 (GMT+08:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
